# Log Analyzer

Простой скрипт на Python для анализа логов HTTP-запросов в формате JSON. Скрипт позволяет формировать отчеты по файлам логов, рассчитывая количество запросов и среднее время ответа для каждого эндпоинта.

## Оглавление

1.  Функциональность
2.  Требования
3.  Установка
4.  Использование
5.  Примеры запуска
6.  Архитектура
7.  Тестирование
8.  FAQ

-----

### Функциональность

Скрипт выполняет следующие задачи:

  * Считывает один или несколько файлов логов, переданных в качестве аргументов.
  * Парсит каждую строку файла как JSON-объект.
  * Формирует отчет, группируя запросы по эндпоинтам (`url`).
  * Рассчитывает общее количество запросов и среднее время ответа (`response_time`) для каждого эндпоинта.
  * Позволяет фильтровать логи по дате.
  * Выводит результат в консоль в виде таблицы.
  * В архитектуру заложена возможность быстрого добавления новых типов отчетов.

-----

### Требования

Для запуска скрипта необходим Python 3.6 или выше.

**Библиотеки:**

  * `argparse`: входит в стандартную библиотеку Python и используется для обработки аргументов командной строки.
  * `tabulate`: используется для красивого вывода таблиц в консоли.
  * `pytest`: используется для запуска тестов.

-----

### Установка

1.  Клонируйте репозиторий:
    ```bash
    git clone https://github.com/ваш_логин/log-analyzer.git
    cd log-analyzer
    ```
2.  (Рекомендуется) Создайте и активируйте виртуальное окружение:
    ```bash
    python3 -m venv .venv
    source .venv/bin/activate  # для Linux/macOS
    # .venv\Scripts\activate.bat  # для Windows
    ```
3.  Установите необходимые зависимости из файла `requirements.txt`:
    ```bash
    pip install -r requirements.txt
    ```

-----

### Использование

Скрипт запускается из командной строки с помощью `python3 main.py` и следующих аргументов:

  * `--file FILE [FILE ...]`: Пути к одному или нескольким файлам логов. **Обязательный** аргумент.
  * `--report {average}`: Название отчета для формирования. В настоящее время поддерживается только `average`. Значение по умолчанию — `average`.
  * `--date YYYY-MM-DD`: **(Опционально)** Фильтрует записи логов по указанной дате.

-----

### Примеры запуска

В репозитории присутствуют файлы `example1.log` и `example2.log` для демонстрации работы скрипта.

1.  **Формирование отчета для одного файла:**

    ```bash
    python3 main.py --file example1.log
    ```

    Вывод:

    ```
    handler                          total    avg_response_time
    -----------------------------  -------  -------------------
    /api/homeworks/...               10996                0.091
    /api/context/...                  4494                0.063
    /api/users/...                    1447                0.066
    ```

2.  **Формирование отчета для нескольких файлов:**

    ```bash
    python3 main.py --file example1.log example2.log
    ```

    Вывод:

    ```
    handler                          total    avg_response_time
    -----------------------------  -------  -------------------
    /api/homeworks/...               55312                0.093
    /api/users/...                    1447                0.066
    ```

3.  **Формирование отчета с фильтрацией по дате:**
    Предположим, что в логах есть записи за 2025-06-22.

    ```bash
    python3 main.py --file example1.log example2.log --date 2025-06-22
    ```

    Вывод:

    ```
    handler                          total    avg_response_time
    -----------------------------  -------  -------------------
    /api/homeworks/...               53865                0.093
    /api/users/...                    1447                0.066
    ```

4.  **Обработка ошибок:**

      * **Файл не найден:**
        ```bash
        python3 main.py --file non_existent_file.log
        ```
        Вывод:
        ```
        Ошибка: файл не найден: non_existent_file.log
        ```
      * **Неверный формат даты:**
        ```bash
        python3 main.py --file example1.log --date 2025-22-06
        ```
        Вывод:
        ```
        Ошибка: Неверный формат даты. Используйте YYYY-MM-DD.
        ```

-----

### Архитектура

Проект спроектирован с учетом возможности расширения.

  * `main.py`: Точка входа в программу. Отвечает за парсинг аргументов, чтение файлов и вывод результата.
  * `reports.py`: Модуль, содержащий логику для генерации различных отчетов.
      * `BaseReport`: Абстрактный базовый класс, который определяет общий интерфейс для всех отчетов. Он обрабатывает общие задачи, такие как фильтрация по дате.
      * `AverageReport`: Конкретная реализация `BaseReport`, которая вычисляет количество запросов и среднее время ответа.

Для добавления нового отчета, например, `UserAgentReport`, достаточно создать новый класс `UserAgentReport` в файле `reports.py`, который будет наследовать `BaseReport` и переопределять метод `get_data()`. Затем нужно добавить новый класс в словарь `reports` в `main.py`.

-----

### Тестирование

Код покрыт тестами, написанными с использованием фреймворка `pytest`. Тесты охватывают критически важный функционал:

  * Корректность расчетов отчета `AverageReport`.
  * Фильтрацию по дате.
  * Обработку ошибок при чтении файлов.
  * Корректное получение класса отчета.

Для запуска тестов используйте команду:

```bash
pytest
```

-----

### FAQ

  * **Можно ли использовать другие библиотеки?**
    Для функционала формирования отчета и работы с файлами использована только стандартная библиотека Python. Для форматирования вывода и тестов используются сторонние библиотеки (`tabulate`, `pytest`), как и было указано в требованиях.

  * **Какой процент покрытия тестами?**
    Тесты покрывают ключевую логику и обработку ошибок. Для проверки покрытия можно использовать `pytest-cov`.

  * **Как добавить новый отчет?**

    Создайте новый класс в `reports.py`, унаследуйте его от `BaseReport` и реализуйте метод `get_data()`. Затем добавьте этот класс в словарь `reports` в `main.py`.
